<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>[Hive] Hive数据类型 - Mryqu's Notes</title><meta name=keywords content="mryqu,yandongqu,博客,程序员,架构师,笔记,技术,分享"><meta property="og:title" content="[Hive] Hive数据类型"><meta property="og:site_name" content="Mryqu's Notes"><meta property="og:image" content="/img/author.jpg"><meta name=title content="[Hive] Hive数据类型 - Mryqu's Notes"><meta name=description content="mryqu | yandongqu | 博客 | 软件 | 架构 | 技术"><link rel="shortcut icon" href=/img/favicon.ico><link rel=apple-touch-icon href=/img/apple-touch-icon.png><link rel=apple-touch-icon-precomposed href=/img/apple-touch-icon.png><link href="/js/vendor/font-awesome/css/font-awesome.min.css?v=4.6.2" rel=stylesheet type=text/css><link href="/js/vendor/fancybox/jquery.fancybox.css?v=2.1.5" rel=stylesheet type=text/css><link href=/css/main.css rel=stylesheet type=text/css><link href=/css/syntax.css rel=stylesheet type=text/css><script type=text/javascript id=hexo.configuration>var NexT=window.NexT||{},CONFIG={scheme:"Pisces",sidebar:{position:"left",display:"post"},fancybox:!0,motion:!0}</script></head><body itemscope itemtype=http://schema.org/WebPage lang=zh-hans><div class="container one-collumn sidebar-position-left page-home"><div class=headband></div><header id=header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class="site-meta custom-logo"><div class=custom-logo-site-title><a href=https://mryqu.github.io/ class=brand rel=start><span class=logo-line-before><i></i></span>
<span class=site-title>Mryqu's Notes</span>
<span class=logo-line-after><i></i></span></a></div><p class=site-subtitle></p></div><div class=site-nav-toggle><button>
<span class=btn-bar></span>
<span class=btn-bar></span>
<span class=btn-bar></span></button></div><nav class=site-nav><ul id=menu class=menu><li class=menu-item><a href=/tags/ rel=section><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class=menu-item><a href=/categories/ rel=section><i class="menu-item-icon fa fa-fw fa-categories"></i><br>分类</a></li><li class=menu-item><a href=/post/ rel=section><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-search"><a href=javascript:; class=popup-trigger><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class=site-search><div class=popup><span class="search-icon fa fa-search"></span>
<input type=text id=local-search-input><div id=local-search-result></div><span class=popup-btn-close>close</span></div></div></nav></div></header><main id=main class=main><div class=main-inner><div class=content-wrap><div id=content class=content><section id=posts class=posts-expand><article class="post post-type-normal" itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline"><a class=post-title-link href=https://mryqu.github.io/post/hive_hive%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/ itemprop=url>[Hive] Hive数据类型</a></h1><div class=post-meta><span class=post-time><span class=post-meta-item-icon><i class="fa fa-calendar-o"></i></span>
<span class=post-meta-item-text>时间：</span>
<time itemprop=dateCreated datetime=2016-03-22T13:04:35+08:00 content="2015-08-13">2015-08-13</time></span>
<span class=post-category>&nbsp; | &nbsp;
<span class=post-meta-item-icon><i class="fa fa-folder-o"></i></span>
<span class=post-meta-item-text>分类：</span>
<span itemprop=about itemscope itemtype=https://schema.org/Thing><a href=/categories/bigdata itemprop=url rel=index><span itemprop=name>BigData</span></a>
&nbsp;</span></span>
<span>&nbsp; | &nbsp;
<span class=post-meta-item-icon><i class="fa fa-eye"></i></span>
<span class=post-meta-item-text>阅读：</span>
<span class=leancloud-visitors-count>252 字 ~2分钟</span></span></div></header><div class=post-body itemprop=articleBody><h3 id=hive支持的数据类型>Hive支持的数据类型</h3><h4 id=原始数据类型>原始数据类型</h4><ul><li>TINYINT</li><li>SMALLINT</li><li>INT</li><li>BIGINT</li><li>BOOLEAN</li><li>FLOAT</li><li>DOUBLE</li><li>STRING</li><li>BINARY</li><li>TIMESTAMP</li><li>DECIMAL</li><li>DECIMAL(precision, scale)</li><li>DATE</li><li>VARCHAR</li><li>CHAR</li></ul><h4 id=复杂数据类型>复杂数据类型</h4><ul><li>array_type</li><li>map_type</li><li>struct_type</li><li>union_type</li></ul><h3 id=原始数据类型-1>原始数据类型</h3><p>在理解原始数据类型时，耗时最多的是TIMESTAMP和BINARY，下文会着重介绍我对这两种类型的理解。
首先创建表primitive_dataytpes_example，字段之间的分隔符没有采用默认的ctrlA，而是使用逗号分隔：</p><pre tabindex=0><code>create table primitive_dataytpes_example
( a TINYINT,
  b SMALLINT,
  c INT,
  d BIGINT,
  e BOOLEAN,
  f FLOAT,
  g DOUBLE,
  h STRING,
  i BINARY,
  j TIMESTAMP,  
  k DECIMAL,
  l DECIMAL (10,2),
  m DATE,
  n VARCHAR(20),
  o CHAR(20)
)
ROW FORMAT DELIMITED 
  FIELDS TERMINATED BY  &#39;,&#39;
  LINES  TERMINATED BY &#39;\n&#39;;
</code></pre><p><img src=/images/2015/8/0026uWfMzy78eDRctpk26.png alt=[Hive] Hive数据类型>
接下来插入一条记录（dummy表的使用见参考三）：</p><pre tabindex=0><code>insert into primitive_dataytpes_example select 123,130,32769,2147483649,true,7.0E-4,7.0E-4,&#39;kkxx&#39;,&#39;ABCD&#39;,current_timestamp(),7.0E-4,7.0E+4,&#39;2011-10-08&#39;,&#39;kkk&#39;,&#39;xxx&#39; from dummy limit 1;
</code></pre><p><img src=/images/2015/8/0026uWfMzy78eExH4Ne34.png alt=[Hive] Hive数据类型></p><pre tabindex=0><code>hadoop@node50064:~/hivetest$ hadoop fs -ls /user/hive/warehouse/primitive_dataytpes_example
Found 1 items
-rwxrwxr-x   2 hadoop supergroup        126 2015-08-12 17:12 /user/hive/warehouse/primitive_dataytpes_example/000000_0
hadoop@node50064:~/hivetest$ hadoop fs -cat /user/hive/warehouse/primitive_dataytpes_example/000000_0
123,130,32769,2147483649,true,7.0E-4,7.0E-4,kkxx,QUJDRA==,2015-08-12 17:12:30.123,0,70000,2011-10-08,kkk,xxx
hadoop@node50064:~/hivetest$ echo `echo QUJDRA== | base64 --decode`
ABCD
hadoop@node50064:~/hivetest$
</code></pre><p>上述Hive存储表文件说明以下几件事情：</p><ul><li>对于7.0E-4，FLOAT类型字段f和DOUBLE类型字段g按输入保存，而DECIMAL字段k则按0保存；对于7.0E+4，DECIMAL(10,2)类型字段l按70000保存。这说明Hive会按字段设置的精度存储数据；</li><li>对于current_timestamp()，TIMESTAMP类型字段j保存的字符格式为 &ldquo;YYYY-MM-DDHH:MM:SS.fff&rdquo;，精度为3而不是9；</li><li>对于"ABCD"，BINARY类型字段i存放了其BASE64编码结果。</li></ul><p>下面我们直接在Hive表放置文件数据。
<img src=/images/2015/8/0026uWfMzy78eHEoFCWf2.png alt=[Hive] Hive数据类型></p><p>上述实验说明以下几件事情：</p><ul><li>即使文件中数据为77777E-4，DECIMAL字段k显示为8；对于存储数据7.0E+4，DECIMAL(10,2)类型字段l显示70000；对于字符串"abcdefghijklmnopqrstuvwxyz"，VARCHAR(20)类型字段n和CHAR(20)类型字段o都显示前20个字符。这说明Hive会按字段设置的精度显示数据；</li><li>对于存储数据2012-10-0810:51:00.123456789，TIMESTAMP类型字段j确实可以按精度9显示；</li><li>对于存储数据BASE64编码RGF0YQo=和a3gxMjMK，BINARY类型字段i能够显示原始字符串。</li></ul><h3 id=复杂数据类型-1>复杂数据类型</h3><p>在理解复杂数据类型时，耗时最多的是UNION，下文会着重介绍我对这种类型的理解。
首先创建表complex_dataytpes_example：
<img src=/images/2015/8/0026uWfMzy78eNqN7Jc86.png alt=[Hive] Hive数据类型>
然后插入两条记录（dummy表的使用见参考三）：</p><pre tabindex=0><code>hive&gt; insert into complex_datatypes_example select array(&#39;hello&#39;,&#39;1&#39;,&#39;2&#39;,&#39;3&#39;), map(1,&#39;k&#39;,2,&#39;x&#39;,3,&#39;g&#39;), named_struct(&#39;name&#39;,&#39;kx&#39;,&#39;age&#39;,123),create_union(0, 123,false, &#34;0.2012&#34;) from dummy limit 1;
hive&gt; insert into complex_datatypes_example select array(&#39;kx&#39;,&#39;xk&#39;), map(123,&#39;hello&#39;,321,&#39;world&#39;), named_struct(&#39;name&#39;,&#39;xk&#39;,&#39;age&#39;,321),create_union(1, 123,false, &#34;0.2012&#34;) from dummy limit 1;
hive&gt; insert into complex_datatypes_example select array(&#39;bye&#39;), map(666,&#39;mryqu&#39;), named_struct(&#39;name&#39;,&#39;kxxk&#39;,&#39;age&#39;,444),create_union(2, 123,false, &#34;0.2012&#34;) from dummy limit 1;
</code></pre><p>结果如下：
<img src=/images/2015/8/0026uWfMzy78eOHfGSJ61.png alt=[Hive] Hive数据类型></p><p>以下是我的体会：</p><ul><li>在对struct插值时，仅在列名为col1、col2&mldr;时可以使用struct UDF，否则必须使用named_structUDF。<img src=/images/2015/8/0026uWfMzy78ePhOxQQf0.png alt=[Hive] Hive数据类型></li><li>在对union插值时，必须用tag选择用那个类型，在我的示例里：0-INT，1-BOOLEAN，2-STRING，这个tag下标不能越界。三个类型的值也必须存在，否则插入失败。<img src=/images/2015/8/0026uWfMzy78ePV8pn86e.png alt=[Hive] Hive数据类型></li><li>对于我的示例，使用了FIELDS、COLLECTION ITEMS、MAPKEYS、LINES四种分隔标识符。对于union类型字段，存储的数据中tag和值也用COLLECTIONITEMS进行分隔，而且只存储所选类型的值。为什么create_unionUDF必须要提供其他类型的值的？有点脱裤子放屁——多此一举了！</li></ul><p>对于array的查询，可以选择下标；对于map的查询，可以选择键；对于struct的查询，可以选择其子字段。</p><pre tabindex=0><code>hive&gt; select a[0],a[1],b[666],c.age from complex_datatypes_example;
OK
hello   1       NULL    123
kx      xk      NULL    321
bye     NULL    mryqu   444
Time taken: 0.042 seconds, Fetched: 3 row(s)
hive&gt; select size(a), map_keys(b) from complex_datatypes_example;
OK
4       [1,2,3]
2       [123,321]
1       [666]
Time taken: 0.035 seconds, Fetched: 3 row(s)
</code></pre><h3 id=参考>参考</h3><p><a href=https://cwiki.apache.org/confluence/display/Hive/LanguageManual+Types>Hive Data Types</a><br><a href=https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL>Hive Data Definition Language</a><br><a href=/post/hive_hive_udf_not_supported_in_insertvalues_command>Hive UDF not supported in insert/values command</a><br><a href=https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF>Hive Operators and User-Defined Functions (UDFs)</a><br><a href=http://hadooptutorial.info/hive-data-types-examples/>Hive Data Types with Examples</a><br><a href=https://my.oschina.net/leejun2005/blog/120463>Hive 中的复合数据结构简介以及一些函数的用法说明</a><br><a href=http://www.hadooptpoint.com/hadoop-hive-data-types-with-examples/></a><br><a href=http://querydb.blogspot.fr/2015/11/hive-complex-data-types.html></a></p></div><footer class=post-footer><div class=post-nav><div style="border:1px dashed #e0e0e0;padding:10px;background-color:#fffeee;background-repeat:no-repeat;background-attachment:scroll;background-position:1%;-moz-background-size:auto auto;-moz-background-clip:-moz-initial;-moz-background-origin:-moz-initial;-moz-background-inline-policy:-moz-initial"><div><p style=margin-top:0>标题：[Hive] Hive数据类型<br>作者：<a target=_blank href=/>mryqu</a><br>声明： 本博客所有文章除特别声明外，均采用 <a href=http://creativecommons.org/licenses/by-nc-sa/3.0/cn/>CC BY-NC-SA 3.0 CN</a> 许可协议。转载请注明出处！</p></div></div><div class=clear></div></div><div class=post-tags><a href=/tags/hive rel=tag title=hive>#hive#</a>
<a href=/tags/binary rel=tag title=binary>#binary#</a>
<a href=/tags/timestamp rel=tag title=timestamp>#timestamp#</a>
<a href=/tags/union rel=tag title=union>#union#</a>
<a href=/tags/datatype rel=tag title=datatype>#datatype#</a></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=https://mryqu.github.io/post/hive_hive%E8%A1%A8%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8%E6%A0%BC%E5%BC%8F/ rel=next title=[Hive] Hive表文件存储格式><i class="fa fa-chevron-left"></i> [Hive] Hive表文件存储格式</a></div><div class="post-nav-prev post-nav-item"><a href=https://mryqu.github.io/post/%E4%BA%86%E8%A7%A3objenesis/ rel=prev title=了解Objenesis>了解Objenesis <i class="fa fa-chevron-right"></i></a></div></div><div class=comments id=comments><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="https://mryqu.github.io/post/hive_hive%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/",this.page.identifier="https://mryqu.github.io/post/hive_hive%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/"};(function(){var e=document,t=e.createElement("script");t.src="//mryqu.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript></div></footer></article></section></div></div><div class=sidebar-toggle><div class=sidebar-toggle-line-wrap><span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
<span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
<span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id=sidebar class=sidebar><div class=sidebar-inner><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target=post-toc-wrap>文章目录</li><li class=sidebar-nav-overview data-target=site-overview>站点概览</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image src=/img/author.jpg alt><p class=site-author-name itemprop=name></p><p class="site-description motion-element" itemprop=description>Programmer & Architect</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href=/post/><span class=site-state-item-count>663</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>28</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>1472</span>
<span class=site-state-item-name>标签</span></a></div></nav><div class="links-of-author motion-element"><span class=links-of-author-item><a href=https://github.com/mryqu target=_blank title=GitHub><i class="fa fa-fw fa-github"></i>
GitHub</a></span>
<span class=links-of-author-item><a href=https://twitter.com/yandongqu target=_blank title=Twitter><i class="fa fa-fw fa-twitter"></i>
Twitter</a></span>
<span class=links-of-author-item><a href=https://www.facebook.com/yandongqu target=_blank title="FB Page"><i class="fa fa-fw fa-facebook"></i>
FB Page</a></span></div><div class="links-of-blogroll motion-element inline"><script type=text/javascript src="//rf.revolvermaps.com/0/0/8.js?i=01h16xrlw6m&m=0&s=220&c=ff0000&cr1=ffffff&f=arial&l=33&bv=35" async></script></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class=post-toc><div class=post-toc-content><nav id=TableOfContents><ul><li><ul><li><a href=#hive支持的数据类型>Hive支持的数据类型</a></li><li><a href=#原始数据类型-1>原始数据类型</a></li><li><a href=#复杂数据类型-1>复杂数据类型</a></li><li><a href=#参考>参考</a></li></ul></li></ul></nav></div></div></section></div></aside></div></main><footer id=footer class=footer><div class=footer-inner><div class=copyright><span itemprop=copyrightYear>&copy;
2009 - 2022</span>
<span class=with-love><i class="fa fa-heart"></i></span>
<span class=author itemprop=copyrightHolder>Mryqu's Notes</span></div><div class=powered-by>Powered by - <a class=theme-link href=http://gohugo.io target=_blank title=hugo>Hugo v0.105.0</a></div><div class=theme-info>Theme by - <a class=theme-link href=https://github.com/xtfly/hugo-theme-next target=_blank>NexT</a></div></div></footer><div class=back-to-top><i class="fa fa-arrow-up"></i>
<span id=scrollpercent><span>0</span>%</span></div></div><script type=text/javascript>Object.prototype.toString.call(window.Promise)!=="[object Function]"&&(window.Promise=null)</script><script type=text/javascript src="/js/vendor/jquery/index.js?v=2.1.3"></script>
<script type=text/javascript src="/js/vendor/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
<script type=text/javascript src="/js/vendor/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
<script type=text/javascript src="/js/vendor/velocity/velocity.min.js?v=1.2.1"></script>
<script type=text/javascript src="/js/vendor/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="/js/vendor/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
<script src="/js/vendor/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<script type=text/javascript src=/js/utils.js></script>
<script type=text/javascript src=/js/motion.js></script>
<script type=text/javascript src=/js/affix.js></script>
<script type=text/javascript src=/js/schemes/pisces.js></script>
<script type=text/javascript src=/js/scrollspy.js></script>
<script type=text/javascript src=/js/post-details.js></script>
<script type=text/javascript src=/js/toc.js></script>
<script type=text/javascript src=/js/bootstrap.js></script>
<script type=text/javascript src=/js/search.js></script>
<script type=text/x-mathjax-config>
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath: [ ['$','$'] ],
      displayMath: [ ['$$','$$'] ],
      processEscapes: true
    },
    "HTML-CSS": { fonts: ["TeX"] }
  });
</script><script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML' async></script></body></html>